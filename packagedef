////////////////////////////////////////////////////////////
// Описание пакета для сборки и установки
// Полную документацию см. на hub.oscript.io/packaging
//

#Использовать "."

///////////////////////////////////////////////////////////////////
// Процедуры установки пакета с клиентской машины        
///////////////////////////////////////////////////////////////////


// Вызывается пакетным менеджером после распаковки пакета на клиентскую машину.
// 
// Параметры:
//   КаталогУстановкиПакета - строка. Путь в который пакетный менеджер устанавливает текущий пакет.
// 
Процедура ПриУстановке(Знач КаталогУстановкиПакета, СтандартнаяОбработка) Экспорт
	// TODO: Реализуйте спец. логику установки, если требуется
КонецПроцедуры


///////////////////////////////////////////////////////////////////
// Процедуры сборки пакета                                          
///////////////////////////////////////////////////////////////////


// Вызывается пакетным менеджером перед началом сборки пакета.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
// 
Процедура ПередСборкой(Знач РабочийКаталог) Экспорт

	ПутьКИсходникамОбработки = ОбъединитьПути(РабочийКаталог, "epf", "ОбработкаКонвертацииMXLJSON", "ОбработкаКонвертацииMXLJSON.xml");
	ПутьККаталогуBin = ОбъединитьПути(РабочийКаталог, "bin");
	
	ОбеспечитьКаталог(ПутьККаталогуBin);

	ПутьКФайлуОбработки = ОбъединитьПути(ПутьККаталогуBin, "ОбработкаКонвертацииMXLJSON.epf");

	ХранилищеКонфигурации = Новый МенеджерХранилищаКонфигурации();
    
	ХранилищеКонфигурации.СобратьОбработкуКонвертации(ПутьКИсходникамОбработки, ПутьКФайлуОбработки);

КонецПроцедуры

Процедура ОбеспечитьКаталог(Знач Каталог)
	
		Файл = Новый Файл(Каталог);
		Если Не Файл.Существует() Тогда
			СоздатьКаталог(Каталог);
		ИначеЕсли Не Файл.ЭтоКаталог() Тогда
			ВызватьИсключение "Каталог " + Каталог + " не является каталогом";
		КонецЕсли;
	
КонецПроцедуры

// Вызывается пакетным менеджером после помещения файлов в пакет.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
//   АрхивПакета - ЗаписьZIPФайла - ZIP-архив с содержимым пакета (включаемые файлы).
// 
Процедура ПриСборке(Знач РабочийКаталог, Знач АрхивПакета) Экспорт
	
	// TODO: Реализуйте спец. логику сборки, если требуется
	//АрхивПакета.Добавить(ПутьКФайлуОбработки,
	//	РежимСохраненияПутейZIP.СохранятьОтносительныеПути,
	//	РежимОбработкиПодкаталоговZIP.ОбрабатыватьРекурсивно);
КонецПроцедуры

// Вызывается пакетным менеджером после сборки пакета.
// 
// Параметры:
//   РабочийКаталог - Строка - Текущий рабочий каталог с исходниками пакета.
//   ПутьКФайлуПакета - Строка - Полный путь к собранному файлу пакета.
// 
Процедура ПослеСборки(Знач РабочийКаталог, Знач ПутьКФайлуПакета) Экспорт
	// TODO: Реализуйте спец. логику сборки, если требуется
КонецПроцедуры

Описание.Имя("v8storage")
		.Версия("0.6.0")
		.ЗависитОт("asserts")
		.ЗависитОт("json")
		.ЗависитОт("v8runner", ">=0.8.0")
		.ЗависитОт("logos")
		.ЗависитОт("fs")
		.ЗависитОт("tempfiles")
		.ВключитьФайл("src")
		.ВключитьФайл("bin")
		.ВключитьФайл("lib.config")
		.ВключитьФайл("README.md")
		.ВключитьФайл("LICENSE.md")
		